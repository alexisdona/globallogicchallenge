<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="587px" preserveAspectRatio="none" style="width:1482px;height:587px;background:#FFFFFF;" version="1.1" viewBox="0 0 1482 587" width="1482px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="355.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="452" y="141.5625"/><rect fill="#FFFFFF" height="284.8672" style="stroke:#181818;stroke-width:1.0;" width="10" x="838" y="212.8281"/><rect fill="#FFFFFF" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1157" y="284.0938"/><rect fill="none" height="90.2031" style="stroke:#000000;stroke-width:1.5;" width="505" x="10" y="399.4922"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="81.2969" y2="506.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="296.5" x2="296.5" y1="81.2969" y2="506.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="457" x2="457" y1="81.2969" y2="506.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="842.5" x2="842.5" y1="81.2969" y2="506.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1161.5" x2="1161.5" y1="81.2969" y2="506.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1425" x2="1425" y1="81.2969" y2="506.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="20" y="77.9951">Cliente</text><ellipse cx="47" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47,21.5 L47,48.5 M34,29.5 L60,29.5 M47,48.5 L34,63.5 M47,48.5 L60,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="20" y="518.6904">Cliente</text><ellipse cx="47" cy="530.4922" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47,538.4922 L47,565.4922 M34,546.4922 L60,546.4922 M47,565.4922 L34,580.4922 M47,565.4922 L60,580.4922 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="251.5" y="77.9951">api/v1/users</text><path d="M276.5,37 L276.5,61 M276.5,49 L293.5,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="305.5" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="251.5" y="518.6904">api/v1/users</text><path d="M276.5,525.9922 L276.5,549.9922 M276.5,537.9922 L293.5,537.9922 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="305.5" cy="537.9922" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="409" y="77.9951">JWTAuthFilter</text><ellipse cx="457" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="453,37,459,32,457,37,459,42,453,37" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="409" y="518.6904">JWTAuthFilter</text><ellipse cx="457" cy="537.9922" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="453,525.9922,459,520.9922,457,525.9922,459,530.9922,453,525.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="802.5" y="77.9951">JWTService</text><ellipse cx="843" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="839,37,845,32,843,37,845,42,839,37" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="802.5" y="518.6904">JWTService</text><ellipse cx="843" cy="537.9922" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="839,525.9922,845,520.9922,843,525.9922,845,530.9922,839,525.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="1098.5" y="77.9951">UserDetailService</text><ellipse cx="1162" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="1158,37,1164,32,1162,37,1164,42,1158,37" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="1098.5" y="518.6904">UserDetailService</text><ellipse cx="1162" cy="537.9922" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="1158,525.9922,1164,520.9922,1162,525.9922,1164,530.9922,1158,525.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1369" y="77.9951">UserRepository</text><path d="M1407,29 C1407,19 1425,19 1425,19 C1425,19 1443,19 1443,29 L1443,55 C1443,65 1425,65 1425,65 C1425,65 1407,65 1407,55 L1407,29 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1407,29 C1407,39 1425,39 1425,39 C1425,39 1443,39 1443,29 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1369" y="518.6904">UserRepository</text><path d="M1407,531.9922 C1407,521.9922 1425,521.9922 1425,521.9922 C1425,521.9922 1443,521.9922 1443,531.9922 L1443,557.9922 C1443,567.9922 1425,567.9922 1425,567.9922 C1425,567.9922 1407,567.9922 1407,557.9922 L1407,531.9922 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1407,531.9922 C1407,541.9922 1425,541.9922 1425,541.9922 C1425,541.9922 1443,541.9922 1443,531.9922 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="355.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="452" y="141.5625"/><rect fill="#FFFFFF" height="284.8672" style="stroke:#181818;stroke-width:1.0;" width="10" x="838" y="212.8281"/><rect fill="#FFFFFF" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1157" y="284.0938"/><polygon fill="#181818" points="285,108.4297,295,112.4297,285,116.4297,289,112.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47" x2="291" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="54" y="107.3638">Realiza una solicitud a /api/v1/users</text><polygon fill="#181818" points="440,137.5625,450,141.5625,440,145.5625,444,141.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="297" x2="446" y1="141.5625" y2="141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="304" y="136.4966">Intercepta la solicitud</text><line style="stroke:#181818;stroke-width:1.0;" x1="462" x2="504" y1="170.6953" y2="170.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="504" x2="504" y1="170.6953" y2="183.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="463" x2="504" y1="183.6953" y2="183.6953"/><polygon fill="#181818" points="473,179.6953,463,183.6953,473,187.6953,469,183.6953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="469" y="165.6294">Verifica el token enviado en el encabezado Authorization</text><polygon fill="#181818" points="826,208.8281,836,212.8281,826,216.8281,830,212.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="462" x2="832" y1="212.8281" y2="212.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="469" y="207.7622">Solicita el email del usuario del token</text><line style="stroke:#181818;stroke-width:1.0;" x1="848" x2="890" y1="241.9609" y2="241.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="890" x2="890" y1="241.9609" y2="254.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="849" x2="890" y1="254.9609" y2="254.9609"/><polygon fill="#181818" points="859,250.9609,849,254.9609,859,258.9609,855,254.9609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="855" y="236.895">Obtiene el email del token</text><polygon fill="#181818" points="1145,280.0938,1155,284.0938,1145,288.0938,1149,284.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="848" x2="1151" y1="284.0938" y2="284.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="855" y="279.0278">Solicita el usuario a través del email obtenido</text><polygon fill="#181818" points="1413,309.2266,1423,313.2266,1413,317.2266,1417,313.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1167" x2="1419" y1="313.2266" y2="313.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="1174" y="308.1606">Obtiene el usuario a través del email</text><polygon fill="#181818" points="473,338.3594,463,342.3594,473,346.3594,469,342.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="467" x2="1161" y1="342.3594" y2="342.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="479" y="337.2935">Devuelve el usuario encontrado</text><line style="stroke:#181818;stroke-width:1.0;" x1="462" x2="504" y1="371.4922" y2="371.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="504" x2="504" y1="371.4922" y2="384.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="463" x2="504" y1="384.4922" y2="384.4922"/><polygon fill="#181818" points="473,380.4922,463,384.4922,473,388.4922,469,384.4922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="469" y="366.4263">Verifica si el token es válido para el usuario obtenido</text><path d="M10,399.4922 L74,399.4922 L74,406.625 L64,416.625 L10,416.625 L10,399.4922 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="90.2031" style="stroke:#000000;stroke-width:1.5;" width="505" x="10" y="399.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="412.5591">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="92" x="89" y="411.7026">[Token válido]</text><polygon fill="#181818" points="58,433.7578,48,437.7578,58,441.7578,54,437.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52" x2="451" y1="437.7578" y2="437.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="64" y="432.6919">Devuelve el resultado de la solicitud</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="515" y1="446.7578" y2="446.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="104" x="15" y="456.9683">[Token inválido]</text><polygon fill="#181818" points="58,477.6953,48,481.6953,58,485.6953,54,481.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52" x2="451" y1="481.6953" y2="481.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="64" y="476.6294">Devuelve un error 403</text><!--MD5=[dcf2a6d56fc5535ad18caa110aeac966]
@startuml
actor Cliente
boundary "api/v1/users" as API
control JWTAuthFilter
control JWTService
control UserDetailService
database UserRepository

Cliente -> API: Realiza una solicitud a /api/v1/users
API -> JWTAuthFilter: Intercepta la solicitud
activate JWTAuthFilter
JWTAuthFilter -> JWTAuthFilter: Verifica el token enviado en el encabezado Authorization
JWTAuthFilter -> JWTService: Solicita el email del usuario del token
activate JWTService
JWTService -> JWTService: Obtiene el email del token
JWTService -> UserDetailService: Solicita el usuario a través del email obtenido
activate UserDetailService
UserDetailService -> UserRepository: Obtiene el usuario a través del email
UserDetailService - -> JWTAuthFilter: Devuelve el usuario encontrado
deactivate UserDetailService
JWTAuthFilter -> JWTAuthFilter: Verifica si el token es válido para el usuario obtenido
alt Token válido
  JWTAuthFilter -> Cliente: Devuelve el resultado de la solicitud
else Token inválido
  JWTAuthFilter -> Cliente: Devuelve un error 403
end
deactivate JWTAuthFilter
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>